# ドメイン駆動設計モデリング・実装ガイド

リンク: [ドメイン駆動設計 モデリング/実装ガイド - little-hands - BOOTH](https://booth.pm/ja/items/1835632)

ドメイン駆動設計の基本的な考え方と実装パターンについて説明されています。

- 自分の認識が間違っていたところ
	- モデルを継続的に改善すること
	    - モデルの図とコードを一致させることの重要性は知りませんでした
	    - 本書では、コードを改善する前にモデルを改善し、それをコードに反映することが推奨されています
- 実装面から考えるDDD
	- まず前提として、コードを書く目的はユースケースを実現することです。
		- ユースケースの中には、ユースケース固有の手順と、他のユースケースでも使われるロジックがあります
		- このロジックは共通化したほうが良くて、このロジックのことをドメインロジックといいます（ドメインモデル、ドメインサービス）
	- 難しい言葉を使うと、アプリケーションビジネスルールと、エンタープライズビジネスルールです
		- [「ビジネスロジック」とは何か、どう実装するのか - Qiita](https://qiita.com/os1ma/items/25725edfe3c2af93d735)

## 1章

- 「モデリングから劇的な利益を得られたプロジェクトから、成功するパターンを抽出します」（DDD Reference）
	- 統計的な考えが好き。結局この成功するパターンってなんだったんだろう。
- 分かっていないこと
	- モデリングをどのように行い、整理したことをどのような形で残すか

## 2章

- モデルを書くときに気をつけること
	- 不整合なインスタンスを存在させないようにする（コンストラクタでの制約や、インスタンスに変更を加えるメソッドの制限）
	- コアなロジックはユースケースではなくモデルに書くと、モデルがドキュメント代わりになってわかりやすくなる
- ドメインモデル図は継続的に更新することが推奨されている

## 3章

- 集約について自分が知っていること
	- 整合性を守りたいオブジェクトのまとまりのことで、実装時にリポジトリの入出力の単位になる
- 「強い」整合性とは？

## 5章

- ある機能を実現するためには、機能を実現するための手続き的な処理（アプリケーションロジック）と、その機能に結びつかない処理（コアロジック）がある
	- 実装面から考えると、コアロジックは使い回せるように分けようというシンプルな話。これがドメイン層。
- エヴァンス本が2003年で、オニオンアーキテクチャが2008年なんだったら、エヴァンス本ではどういう実装をすることが推奨されているんだろう？
- 玉ねぎが通信しているのが面白かった

## 6章 ドメイン層の実装

- DDDのパターン（エンティティ、値オブジェクト、ファクトリ）以外を使ってもよい
	- あくまでよくあるパターンに名前をつけてあるだけだと思うので、必要に応じてそれ以外のクラスを作ってよい

## 7章 ユースケース層の実装

- ユースケースはシングルアクションにするのがよい（publicメソッドが1つ）
	- 単一責任の原則
	- 複数のユースケースを詰め込むと、テストが肥大化するため
- ユースケースの戻り値については、いつも適当に返しているので改善したい
	- フロント側で登録した結果を使いたいということがあまりない

## 10章

- 例外について
	- ドメイン層で定義する例外と、ユースケース層で定義する例外がある
	- いつもは業務例外はドメイン層で定義して、それをドメイン層で投げたりユースケースで投げたりしている
		- 確かに、特定のユースケースでしか起きない例外ならユースケース層に定義したほうがよさそう

