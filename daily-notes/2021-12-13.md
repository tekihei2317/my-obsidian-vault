# 2021-12-13

## 請求書のプレビュー生成処理の実装

16:39 フロントエンドとの連携の実装

14:04 arrayをモデルのコレクションにしたい

`array_map`でモデルの配列にしてから`collect`メソッドで`Illuminate\Support\Collection`のインスタンスにしました。これで良いのかは分からない...。

13:56 1日に5回くらいDocker Daemonを再起動している

11:56 何かの調子がわるい

ページの表示でタイムアウトしたんですが...。これあが起きるとコンテナが落とせなって、Dockerデーモンを再起動しないといけないのでめちゃくちゃ面倒...。

10:52 プレビュー生成処理の実装

PHPでも連想配列の分割代入ができるっぽい。

10:23 見積書はプレビュー生成でバリデーションエラー表示できてないよね

9:38 Inertiaにファイルアップロードの機能があったけどあれは何だろう

これはファイルを一緒に送っている。保存するときに、バックエンドでファイルをアップロードしてURLを保存する。クールじゃないと一瞬思ったけど、考えてみるとクライアントでやるかサーバーでやるかの違いしかない（ただ、SPA風にバックエンドはURL保存するだけのほうがキレイだと思う）。

9:25 プレビューの生成をInertiaで出来るかどうか

Inertiaを使うと、バックエンドからデータを返すときにはpropsを渡す形になる。そのため、例えばファイルアップロードをInertiaでやろうとすると、ファイルアップロードを使うすべての画面の表示アクション（oo一覧、oo編集等）にファイルアップロード用のpropsを書かなければいけなくなる。

ファイルアップロード用のアクションを作り、アップロードしたファイルのURLをセッションに入れ、APIのパラメータで指定したURLにリダイレクトし、リダイレクト先のアクションでセッションからURLを復元して、propsで返すというようにする必要がありそう。

→リダイレクトにパラメータをつければ良さそう。

[Laravelでリダイレクトする方法や実装パターン6つ書いてみた | codelikeなブログ](https://codelikes.com/laravel-redirect/)
[InertiaでXHRリクエスト Inertia.js入門 #6 | SOHO MIND](https://blog.shipweb.jp/archives/488)