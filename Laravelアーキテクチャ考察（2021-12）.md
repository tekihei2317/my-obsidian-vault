# Laravelアーキテクチャ考察（2021-12）

## 今のプロジェクトでのやり方

[alexeymezenin/laravel-realworld-example-app: Laravel implementation of the RealWorld app](https://github.com/alexeymezenin/laravel-realworld-example-app)を参考にしている。ざっくりと説明すると以下のような感じ。

- リクエストのバリデーションはフォームリクエストで行う
- コントローラーのコンストラクタインジェクションでモデルを作る
- コントローラーでモデルを使ってデータを操作する
- コントローラーでデータを返却するときに、APIリソースを使って整形する

基本的なCRUD+SQLでの集計処理みたいな感じなので、コントローラーのメソッドもシンプルにおさまっている。少し複雑なSQLの組み立てをUsecaseに切り出してみたこともあったが、モデルで使い回したくなったため結局モデルに移動した。

設計の改善のため、どのような考えがあるのかを調べてみる。

## 調査

### [5年間 Laravel を使って辿り着いた，全然頑張らない「なんちゃってクリーンアーキテクチャ」という落としどころ](https://zenn.dev/mpyw/articles/ce7d09eb6d8117)

まだ分からないところがたくさんあるけれど、これをベースに考えると良さそう。この記事のやり方は、MVCの拡張として自然に考えられる。設計の話になるとRepositoryとかが出てくるが、なぜそんな概念が出てくるのかが理解できなかった。

ModelとRepositoryは対立するものなような気がしている。Modelしか使ったことがないので、Repositoryという概念がそのように見えたのだと思う。

### [Laravel で Request, UseCase, Resource を使いコントロールフローをシンプルにする - Qiita](https://qiita.com/nunulk/items/5297cce4545ac3c16822)

Requestクラスでモデルを生成している。これはInput Boundaryという役目をしているらしい。あとEnumの問題は今のプロジェクトでもあるので解決したい（ステータス等をIDで持つか文字列で持つかの問題）。

基本的にはIDで持つのがよいと思っている（文字だと表記揺れとかを考えないといけないので）。どこのレイヤで変換すれば良いかが分かっていない。バックエンドで使わずに、フロントエンドだけで持つとかもありなのかもしれない。

### [Controller, UseCase, Service (および Model) の役割分担についての考察 - Qiita](https://qiita.com/nunulk/items/bc7c93a3dfb43b01dfab)

UseCase = ドメインサービス、Service = インフラサービスだと思っていたが、この記事は違いそう。

この記事ではServiceにインフラサービスとドメインサービスの両方を含んでいそうな気がする。UseCaseはワークフローの構築とあるので、ドメインサービスという訳でもない？

## 感想

今のプロジェクトはそんなに複雑化していないので、モデルやコントローラーに肥大化の傾向が見られたときが改善のときだと思う。またテストを書くことでも、テストの書きやすさという点で改善点が見つけられると思った。
