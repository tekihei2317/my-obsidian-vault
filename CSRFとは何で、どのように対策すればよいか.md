# CSRFとは何で、どのように対策すればよいか

CSRFとはクロスサイトリクエストフォージェリーの略で、サイトをまたいでリクエストを偽造する攻撃のことです。ここでのサイトは、同じ組織が管理する登録可能なドメインのことをいいます。

TODO: 具体例を書く

CSRFはブラウザが同じドメインに対しては同じクッキーを送る性質を利用しています。つまり、あるサイトAの認証情報がクッキーに保存されているとき、偽造サイトBからのリクエストでも認証情報が送信されます。そして、ユーザーやサイトの製作者が意図しないアクションが実行されてしまいます。

## どのように対策するか

意図したサイトからのリクエストだということを保証すればよいです。以下のような対策方法があります。

- トークンを使用する
	- 別サイトならば別オリジンなので、CORSによってトークンが取得できないことが保証できます
- カスタムヘッダでPreflight Requestを起こす（Preflitght RequestはCORSでブロックされる？）
- SameSite Cookieを使う
	- [CookieのSameSite属性とはなにか](CookieのSameSite属性とはなにか.md)
- Originを見る（Originは基本的には悪意のある第三者によって偽造不可能っぽいです）

## 参考

- [脆弱なサイトと罠サイトを実際に作って学ぶ『CSRF』とその対策 | Hypertext Candy](https://www.hypertextcandy.com/csrf-hands-on-tutorial)
	- 攻撃と対策を実践する形で分かりやすかったです
- [これで完璧！今さら振り返る CSRF 対策と同一オリジンポリシーの基礎 - Qiita](https://qiita.com/mpyw/items/0595f07736cfa5b1f50c#%E3%81%AA%E3%81%9C%E5%9B%BA%E6%9C%89%E3%81%AE-http-%E3%83%98%E3%83%83%E3%83%80%E3%81%A7%E5%AF%BE%E7%AD%96%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%AE%E3%81%8B)
	- 体系的にまとめられています